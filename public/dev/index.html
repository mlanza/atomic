<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Entities (Development)</title>
  <meta name="description" content="Entities">
  <meta name="author" content="Mario T. Lanza">
  <script src="../assets/require.js"></script>
  <script src="../assets/boot.js"></script>
  <script type="text/javascript">
    define('context', function(){
      return {};
    });
    require(["atomic"], function(atomic){ //repl use
      Object.assign(window, atomic);
    });
    /*require(["atomic", "../assets/ents"], function(atomic, ents){ //repl use
      Object.assign(window, atomic, {ents: ents});
    });*/
    require(['atomic/core', 'atomic/dom', 'atomic/reactives', 'atomic/transducers', 'rxjs'], function(_, dom, $, t, rxjs){

      var nums = $.Observable.from(_.range(5));
      var mult = $.pipe(nums, t.map(_.inc), t.take(2), t.map(_.str));
      //$.sub(nums, _.see("nums"));
      //$.sub(mult, _.see("mult"));

      var source = $.cell(0);
      var sink = $.cell(_.deref(source));
      $.sub(sink, _.see("sink"));
      var disconnect = $.connect(source, sink);
      var stop = setInterval(function(){
        _.swap(source, _.inc);
        if (_.deref(source) === 2) {
          disconnect();
        }
        if (_.deref(source) > 5) {
          clearInterval(stop);
        }
      }, 1000);

      var button = dom.tag('button'),
          click = button("Click Me");

      dom.append(document.body, click);

      var clicks = $.Observable.fromEvent(click, "click");
      var dos = $.pipe(clicks, t.take(2));

      $.sub(dos,
        $.observer(
          _.see("dos"),
          _.see("dos/err"),
          _.see("dos/complete")));

      Object.assign(window, {dos, mult, clicks});

      //_.reduced = $.complete; // worked with transducer!

      //TODO useful pattern or are there better?

    });
  </script>
</head>
<body id="outline">
</body>
</html>